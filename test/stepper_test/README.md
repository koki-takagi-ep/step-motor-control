# 28BYJ-48 ステッピングモーター制御ガイド

このリポジトリには、Arduino と ULN2003A ドライバーボードを使用した 28BYJ-48 ステッピングモーターの制御コードとセットアップ方法が含まれています。

## 目次

1. [ハードウェア構成](#ハードウェア構成)
2. [配線方法](#配線方法)
3. [ソフトウェアのセットアップ](#ソフトウェアのセットアップ)
4. [使用方法](#使用方法)
5. [LED表示について](#led表示について)
6. [トラブルシューティング](#トラブルシューティング)

## ハードウェア構成

必要な部品：

- Arduino ボード（UnoやNanoなど）
- 28BYJ-48 ステッピングモーター (5V DC版)
- ULN2003Aドライバーボード
- ジャンパーワイヤー
- USBケーブル（Arduinoへの接続用）
- 5V電源（通常はUSBから供給可能）

28BYJ-48の仕様：
- 動作電圧: 5V DC
- 4相5線式ユニポーラステッピングモーター
- 1回転あたり約4096ステップ (内部歯車比 1:64)
- 最大トルク: 約34.3 mN·m (0.34 kg·cm)

## 配線方法

### ステッピングモーターとドライバーボードの接続

ステッピングモーターの5本のケーブル（通常は赤、オレンジ、黄色、ピンク、青）をドライバーボードのコネクタに直接差し込みます。コネクタは形状がマッチするので逆には接続できません。

### ドライバーボードとArduinoの接続

| ドライバーボード | Arduino |
|----------------|---------|
| IN1 | デジタルピン 8 |
| IN2 | デジタルピン 9 |
| IN3 | デジタルピン 10 |
| IN4 | デジタルピン 11 |
| + (VCC) | 5V |
| - (GND) | GND |

![配線図](https://i.imgur.com/6vTnS3j.png)

## ソフトウェアのセットアップ

### AccelStepperライブラリのインストール

1. Arduino IDEを開く
2. 「スケッチ」→「ライブラリをインクルード」→「ライブラリを管理」を選択
3. 検索ボックスに「AccelStepper」と入力
4. 「AccelStepper by Mike McCauley」をインストール

### スケッチのアップロード

1. `stepper_test.ino` ファイルをArduino IDEで開く
2. Arduinoを接続し、正しいボードとポートを選択
3. スケッチをコンパイルしてアップロード

## 使用方法

1. モーターとドライバーボードを適切に接続
2. スケッチをArduinoにアップロード
3. シリアルモニター（ボーレート: 9600）を開く
4. 以下のコマンドを送信してモーターを制御:

| コマンド | 動作 |
|--------|-----|
| 1 | 時計回りに1回転 |
| 2 | 反時計回りに1回転 |
| 3 | 時計回りに半回転 |
| 4 | 反時計回りに半回転 |
| 5 | 速度を上げる |
| 6 | 速度を下げる |

## LED表示について

ULN2003Aドライバーボード上の4つのLEDは、モーターの4つのコイル（相）の励磁状態を示しています:

- 各LEDはコイル（相）の通電状態を表示
- 点灯 = そのコイルは励磁されている状態（HIGH）
- 消灯 = そのコイルは非励磁状態（LOW）

### LED点灯パターン

ステップ駆動モードによって異なるパターンで点灯します:

1. **ウェーブドライブ（1相励磁）**: 一度に1つのLEDだけが点灯
2. **フルステップ（2相励磁）**: 常に2つのLEDが同時に点灯
3. **ハーフステップ（1-2相励磁）**: 1つのLEDの点灯と2つのLEDの点灯が交互に発生

回転方向によるLEDの動き:
- 時計回り: LEDは順方向に点灯 (IN1→IN2→IN3→IN4)
- 反時計回り: LEDは逆方向に点灯 (IN4→IN3→IN2→IN1)

LEDの点灯パターンはトラブルシューティングやモーターの動作確認に非常に有用です。

## トラブルシューティング

| 問題 | 考えられる原因と解決策 |
|-----|------------------|
| モーターが動かない | - 配線を確認<br>- 電源接続を確認<br>- ドライバーボードのLEDが点灯するか確認<br>- スケッチが正しくアップロードされているか確認 |
| モーターが振動するだけで回転しない | - 速度が速すぎる（速度を下げる）<br>- 配線順序が正しくない<br>- モーターとドライバーボードの接続を確認 |
| 回転方向が逆 | - コード内のピン接続順序を変更<br>- または回転方向を反転するコマンドを使用 |
| LEDは点灯するがモーターが回転しない | - モーターの接続を確認<br>- モーターのケーブルが損傷していないか確認 |
| 不安定な動き | - 電源電圧が不安定<br>- 適切な外部電源（5-12V）を使用 |

## 高度な使い方

- **加速・減速の調整**: `setAcceleration()`と`setMaxSpeed()`を使用
- **位置制御**: `moveTo()`または相対位置には`move()`を使用
- **速度制御**: `setSpeed()`と`runSpeed()`を使用（加速なし）
- **非ブロッキング制御**: `run()`の代わりに`runSpeed()`を使用

## 参考資料

- [AccelStepperライブラリドキュメント](https://www.airspayce.com/mikem/arduino/AccelStepper/)
- [28BYJ-48データシート](http://robocraft.ru/files/datasheet/28BYJ-48.pdf)
- [ULN2003Aデータシート](https://www.ti.com/lit/ds/symlink/uln2003a.pdf)

## ライセンス

このプロジェクトは自由に使用・改変可能です。商用目的での使用も許可されています。

## 作成者情報

- **作成者**: Koki Takagi
- **作成日**: 2025年5月10日
