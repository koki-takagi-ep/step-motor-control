# ステッピングモーター角度制御システム（Arduino R4 Wi-Fi対応版）

このプログラムは28BYJ-48ステッピングモーターを指定した角度まで正確に回転させるためのものです。Arduino R4 Wi-Fiの内蔵無線通信機能を利用して、ワイヤレスでモーターを制御できます。

## 機能

- **Wi-Fi接続**: 内蔵Wi-Fi機能によるワイヤレス制御
- **絶対角度制御**: 指定した角度（0〜360度）へモーターを回転させます
- **相対角度制御**: 現在位置から指定した角度だけモーターを回転させます
- **最短経路計算**: 目標角度まで最短のルートで回転します
- **電源節約モード**: 停止時に自動的にモーターの電源を切り、発熱を防ぎます
- **速度プリセット**: 5段階の速度設定からトルクと速度のバランスを選択できます
- **現在位置リセット**: 現在位置を0度として再設定できます

## ハードウェア接続

### モーター接続
- MOTOR_PIN1: 8番ピン
- MOTOR_PIN2: 9番ピン
- MOTOR_PIN3: 10番ピン
- MOTOR_PIN4: 11番ピン

## セットアップ手順

1. **Wi-Fi設定の変更**:
   - スケッチファイル内の以下の部分を変更します:
   ```cpp
   const char* ssid = "YOUR_WIFI_SSID";      // ご使用のWi-FiのSSID
   const char* password = "YOUR_WIFI_PASSWORD";  // Wi-Fiのパスワード
   ```

2. **スケッチのアップロード**:
   - Arduino IDEを使ってスケッチをArduino R4 Wi-Fiにアップロードします
   - アップロード後、シリアルモニタでIPアドレスを確認します

3. **接続方法**:
   - パソコンからTelnetクライアントを使用して、表示されたIPアドレスのポート23に接続します
   - Windows: Putty, TeraTerm等の端末エミュレータ
   - Mac/Linux: ターミナルから `telnet [IPアドレス] 23`

## 使用方法

Wi-Fi経由で接続したら、以下のコマンドを送信してモーターを制御します：

- `a[角度]`: 絶対角度を指定（例: `a90` で90度の位置へ移動）
- `r[角度]`: 相対角度を指定（例: `r45` で現在位置から45度移動）
- `z`: 現在位置を0度にリセット
- `s`: 現在の状態を表示
- `p`: 電源節約モードの切り替え
- `v[1-5]`: 速度プリセットを選択（1:遅い, 3:通常, 5:高速）
- `h`: ヘルプメッセージを表示

## 速度プリセット

1. **非常に遅い**: 高トルク、高精度（400 steps/sec）
2. **遅い**: バランス型（700 steps/sec）
3. **通常**: バランス型（1000 steps/sec）
4. **速い**: 高速、中トルク（1300 steps/sec）
5. **非常に速い**: 最高速度、低トルク（1600 steps/sec）

## 接続用クライアントソフトウェア

以下のようなソフトウェアでArduino R4 Wi-Fiに接続できます：

### Windows
- PuTTY
- TeraTerm
- Windows標準Telnetクライアント（コマンドプロンプトから `telnet [IPアドレス] 23`）

### Mac
- Terminal.app（`telnet [IPアドレス] 23`）
- iTerm2

### Linux
- ターミナル（`telnet [IPアドレス] 23`）

### モバイルアプリ
- JuiceSSH（Android）
- Termius（iOS/Android）

## モバイルアプリの作成

より高度な制御が必要な場合は、以下のような方法でモバイルアプリを作成できます：

1. **Web Interface**: Arduino R4 Wi-Fiでシンプルなウェブサーバーを実装
2. **専用アプリ**: 
   - MIT App Inventor
   - Flutter
   - React Native
   などを使用して独自のインターフェースを作成

## トラブルシューティング

1. **Wi-Fi接続ができない場合**:
   - SSIDとパスワードが正しいか確認
   - Arduino R4 Wi-FiがWi-Fiルーターの範囲内にあるか確認
   - Wi-Fiネットワークが2.4GHz帯域を使用しているか確認（Arduino R4 Wi-Fiは5GHzに対応していない場合があります）

2. **接続が不安定な場合**:
   - Arduino R4 Wi-Fiとルーターの距離を近づける
   - 電源の安定性を確認

3. **コマンドが反応しない場合**:
   - 接続が維持されているか確認
   - 改行コードが正しく送信されているか確認

## 注意事項

- 高速での動作時はトルクが低下します
- 長時間の連続動作は避けてください（モーターが過熱する可能性があります）
- 電源節約モードを無効にすると、停止時もコイルに電流が流れ続けます
- Wi-Fi接続は電力を消費するため、バッテリー駆動の場合は動作時間に影響します
- セキュリティのため、重要な用途では公開ネットワークでの使用を避けてください
