# ステッパーモーター角度制御プログラム v2

28BYJ-48 ステッパーモーターを使用した角度制御プログラムです。v2では、タイムスタンプと設定角度のログ機能が追加されています。ログはシリアル通信でPCに送信され、PCでCSVファイルとして保存されます。

## 必要なハードウェア

- Arduino（Uno, Nano, Megaなど）
- 28BYJ-48 ステッパーモーターとULN2003ドライバーボード
- USBケーブル（Arduino - PC間の通信用）

## 必要なライブラリ

### Arduino

- Stepper（標準ライブラリ）

### PC側（Pythonスクリプト用）

- Python 3.x
- pyserial（`pip install pyserial`でインストール）

## 配線方法

### ステッパーモーター（ULN2003ドライバー）

- IN1 → Arduino デジタルピン 8
- IN2 → Arduino デジタルピン 9
- IN3 → Arduino デジタルピン 10
- IN4 → Arduino デジタルピン 11
- + → Arduino 5V
- - → Arduino GND

## プログラムの機能

- 0-360度の範囲で、指定した角度にステッパーモーターを動かせます
- 角度設定時に、タイムスタンプと設定角度をシリアル通信でPCに送信します
- ログデータはPC側でCSVファイルとして保存されます
- タイムスタンプはArduinoの起動からの経過時間（ミリ秒）です

## 使用方法

### Arduinoプログラム

1. `stepper_simple_angle_v2.ino`をArduinoにアップロードします
2. シリアルモニターを開きます（ボーレート：9600）
3. 以下のコマンドを使用できます：
   - `0-360`: 目標角度を設定（例：`90`と入力で90度に移動）
   - `r` または `reset`: 現在の位置を0度にリセット
   - `p` または `pos`: 現在の角度を表示
   - `t` または `time`: 起動からの経過時間を表示

### PC側ログ記録プログラム

1. Pythonとpyserialをインストールします
2. Arduino をPCに接続します
3. 以下のコマンドでログ記録プログラムを実行します：

```bash
python log_recorder.py [シリアルポート] [ボーレート]
```

例：
```bash
# Linux/macOSの場合
python log_recorder.py /dev/ttyACM0 9600

# Windowsの場合
python log_recorder.py COM3 9600
```

4. プログラムが実行されると、Arduinoから送信されるログデータが`angle_log_YYYYMMDD_HHMMSS.csv`ファイルに記録されます
5. 終了するには `Ctrl+C` を押します

## ログファイルのフォーマット

ログはCSV形式で保存され、以下のフォーマットになります：

```
timestamp,angle
12345,90
67890,180
```

タイムスタンプはArduinoの起動からの経過時間（ミリ秒）です。

## トラブルシューティング

- シリアルポートが見つからない場合は、Arduino が正しく接続されているか確認してください
- ログ記録プログラムが正常に動作していない場合は、Arduinoのシリアルモニターを閉じてからログ記録プログラムを実行してください（シリアルポートは同時に1つのプログラムしか使用できません）
